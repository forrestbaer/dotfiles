#GLOBAL SETTINGS

set header_cache     = "$HOME/.mailcache"
set message_cachedir = "$HOME/.mailcache"

set sendmail="/usr/bin/msmtp"
set quote_regexp="^( {0,4}[>|:#%]| {0,4}[a-z0-9]+[>|]+)+"
set sleep_time=0
set sort_browser=date
set sort_aux=reverse-last-date-received
set sort=threads
set collapse_unread
set mail_check_stats
set timeout = 30
set imap_keepalive = 600
set mailcap_path="~/.config/neomutt/mailcap"
set edit_headers
set use_from
set envelope_from
set tilde
set copy
set delete
set nobeep
set pager_stop
set smart_wrap
#set editor="nvim -c 'set spell spelllang=en'"
set editor="nvim '+/^$' -c 'set nohlsearch spell spelllang=en ft=mail'"
set menu_scroll
set wrap = 80
set sidebar_width = 20
set sidebar_visible
set sidebar_short_path
set sidebar_folder_indent
set status_chars = " *%A"
set attach_keyword = "\\<attach(|ed|ments?)\\>"
set abort_noattach = ask-yes

set pager_index_lines = 20
set pager_context = 5

set status_format="%* ( %f [%n/%m] )"
set sidebar_format="%B%?F? [%F]?%* %?N?%N/?%S"
set index_format = ">%2C %Z [%{%b %d}] %-20.20L â”‚ %s"
set date_format = "!%a, %b %d, %Y at %I:%M%p (%Z)"
set attribution = "On %d, %v (%a) said:" 
set pager_format = "%* a:%X [%P]"

unset help
unset mark_old
unset markers
unset wait_key

auto_view text/html
alternative_order text/plain text/enriched text/html


# BINDINGS

set query_command= "khard email --parsable '%s'"
bind editor <Tab> complete-query
bind editor ^T    complete

bind attach,index,pager \cd next-page
bind attach,index,pager \cu previous-page
bind attach,index g first-entry
bind attach,index G last-entry

bind index,pager \cp sidebar-prev
bind index,pager \cn sidebar-next
bind index,pager \co sidebar-open

macro index ,n "<next-unread-mailbox><enter>"
macro index ,a "<change-folder>=Archive<enter>"
macro index ,s "<change-folder>=Sent<enter>"
macro index ,d "<change-folder>=Drafts<enter>"
macro index M "<save-message>?<toggle-mailboxes>" "move a message to a mailbox"
bind index <delete> delete-message
bind index p recall-message
bind compose p postpone-message

bind pager g top
bind pager G bottom
bind pager k previous-line
bind pager j next-line
bind pager d next-page
bind index,pager h previous-entry
bind index,pager l next-entry
bind pager u previous-page
bind pager n next-unread

macro index,pager \cb "<pipe-message> urlscan -c<Enter>" "call urlscan to extract URLs out of a message"
macro attach,compose \cb "<pipe-entry> urlscan -c<Enter>" "call urlscan to extract URLs out of a message"

# COLORSCHEME
color normal     white         default

# main colors
color status     black         cyan
color indicator  white         blue
color tree       green         black
color error      brightred     black
color message    brightwhite   black

# uncolor certain messages
uncolor index "~P"
uncolor index "~N"
uncolor index "~T"
uncolor index "~F"
uncolor index "~D"
uncolor index "~O"

# and recolor them appropriately
color index      brightcyan     default "~T"
color index      yellow         default "~O"

# set up the headers
color header     brightcyan     default "^from:"
color header     cyan           default "^to:"
color header     cyan           default "^cc:"
color header     white    brightblack "^date:"
color header     brightwhite          default "^subject:"

# message bodies
color attachment brightblack   default
color search     brightyellow  black
color signature  cyan          default
color tilde      brightblack   default

# sidebar
color sidebar_divider   brightblack black
color sidebar_new       brightwhite black
color sidebar_flagged   magenta     black
color sidebar_indicator white       brightblack

# urls
color body       brightblue    default "(^|<| )mailto:[^ ]+@[^ ]( |>|$)"
color body       brightblue    default "(^|<| )(http|https|ftp|file|telnet|news|finger)://[^ ]+( |>|$)"

# *bold*, _underline_, and /italic/
color body       brightcyan    default "(^| )\\*[^ ]+\\*( |$)"
color body       brightcyan    default "(^| )_[^ ]+_( |$)"
color body       brightcyan    default "(^| )/[^ ]+/( |$)"

# quote blocks
color quoted     magenta       default
color quoted1    cyan          default
color quoted2    green         default
color quoted3    magenta       default
color quoted4    cyan          default
color quoted5    green         default
color quoted6    magenta       default
color quoted7    cyan          default

color index             green           black       '.*'
color index             red             default     ~D
color index             brightwhite     default     ~N
color index_author      white           black       '.*'
color index_author      red             black       ~D
color index_author      magenta         black       ~F
color index_flags       brightmagenta   default     ~F
color index_subject     white           default     ~A
color index_subject     red             default     ~D
color index_subject     brightmagenta   default     ~F
color index_collapsed   default         brightblue
color index_date        brightblack     default
color index_label       default         brightgreen
color index_number      blue            default
color index_size        cyan            default


# FOLDER HOOKS

folder-hook .bills$     'unset from; my_hdr From: Forrest Baer <bills@forrestbaer.com>'
folder-hook .work$      'unset from; my_hdr From: Forrest Baer <work@forrestbaer.com>'
folder-hook .private$   'unset from; my_hdr From: Forrest Baer <forrest@forrestbaer.com>'
folder-hook .public$    'unset from; my_hdr From: Forrest Baer <public@forrestbaer.com>'
folder-hook . 'set record="^"'


# ACCOUNT DATA
# these files should be have correct permissions and contain:
# imap_user, imap_pass, smtp_url, smtp_pass, smtp_authenticators
# realname, from, folder, spoolfile, record, postponed, mailboxes
source ~/.config/neomutt/forrestbaer.com
